function startAjaxLoading(){showAjaxLoading&&$(".loading-background").fadeIn().css("display","flex")}function stopAjaxLoading(){$(".loading-background").fadeOut()}function exportImage(){var n=cy.png({bg:"#605ca8",full:!1});$("#modal-view-image").modal("toggle");$("#img-graph").attr("src",n)}function load_select2ToHtml(){$(".select2").select2({escapeMarkup:function(n){return n}});$(".select2-multiple").select2({allowClear:!0,tags:!0})}function load_iCheckToHtml(){$("input").iCheck({checkboxClass:"icheckbox_square-purple",radioClass:"iradio_square-purple",increaseArea:"20%"})}function init_ButtonCheckbox(){$(".button-checkbox").each(function(){function i(){var i=t.is(":checked");n.data("state",i?"on":"off");n.find(".state-icon").removeClass().addClass("state-icon "+f[n.data("state")].icon);i?n.removeClass("btn-default").addClass("btn-"+u+" active"):n.removeClass("btn-"+u+" active").addClass("btn-default")}function e(){i();n.find(".state-icon").length===0&&n.prepend('<i class="state-icon '+f[n.data("state")].icon+'"><\/i> ')}var r=$(this),n=r.find("button"),t=r.find("input:checkbox"),u=n.data("color"),f={on:{icon:"glyphicon glyphicon-check"},off:{icon:"glyphicon glyphicon-unchecked"}};n.on("click",function(){t.prop("checked",!t.is(":checked"));t.triggerHandler("change");i()});t.on("change",function(){i()});e()})}function activateTab(n){$('.nav-tabs a[href="#'+n+'"]').tab("show")}function blockEditing(n){var t=$("#lnk-save"),r=$("#div-alert-you-need-to-refresh"),i=$("#lnk-open-download");n?(r.show(),t.fadeTo("slow",.2),t.css("cursor","default"),t.removeClass("faa-parent animated-hover"),t.unbind("click"),t.click(function(){addToastMessage("You need to refresh the service description to continue editing it.","warning")}),i.fadeTo("slow",.2),i.css("cursor","default"),i.removeClass("faa-parent animated-hover"),i.unbind("click"),i.click(function(){addToastMessage("You need to refresh the service description to continue editing it.","warning")})):(r.hide(),t.fadeTo("slow",1),t.css("cursor","pointer"),t.addClass("faa-parent animated-hover"),t.unbind("click"),t.click(function(){updateServiceDescription()}),i.fadeTo("slow",1),i.css("cursor","pointer"),i.addClass("faa-parent animated-hover"),i.unbind("click"),i.click(function(){}),$(".toast-signalr").remove())}function addToastMessage(n,t,i){var r=5e3,u;i!==null&&i!==undefined?r=i:t==="danger"&&(r=2e4);u={closeButton:!0,newestOnTop:!0,timeOut:r,escapeHtml:!1};toastr[t](n,"",u)}function setCookie(n,t,i){var u="",r;i&&(r=new Date,r.setTime(r.getTime()+i*864e5),u="; expires="+r.toUTCString());document.cookie=n+"="+(t||"")+u+"; path=/"}function getCookie(n){for(var t,r=n+"=",u=document.cookie.split(";"),i=0;i<u.length;i++){for(t=u[i];t.charAt(0)===" ";)t=t.substring(1,t.length);if(t.indexOf(r)===0)return t.substring(r.length,t.length)}return null}function eraseCookie(n){document.cookie=n+"=; Max-Age=-99999999;"}function hideAllServiceDescriptionsButThis(n){n&&$.each($(".service-description-eye"),function(t,i){var r=$(i);$(r.closest("li")).attr("id-service-description")!==n.toString()?(r.removeClass("fa-eye"),r.addClass("fa-eye-slash"),r.removeClass("text-green"),r.addClass("text-red")):(r.addClass("fa-eye"),r.removeClass("fa-eye-slash"),r.addClass("text-green"),r.removeClass("text-red"))})}function openSavedServiceDescription(n){jQuery.support.cors=!0;$.ajax({url:"Site/OpenSavedServiceDescription",data:{idServiceDescription:n},type:"GET",success:function(n){if(n!==null)if(n.serviceDescription!==null){fillCytoscape(JSON.parse(n.serviceDescription.GraphJson));adjustUserNodesPositionsOnGraph(JSON.parse(n.serviceDescription.GraphJson));fillCodeMirror(n.serviceDescription.Xml);$("#div-service-description-in-view").show();$("#lbl-service-description-name-in-view").text(n.serviceDescription.ServiceName);$("#treeview-service-description").append(n.serviceDescription.HtmlTreeViewMenu);setCookie(GRASEWS_SERVICEDESCRIPTION_ON_VIEW_COOKIE,n.serviceDescription.Id);createContextMenusForTreeView();hideAllServiceDescriptionsButThis(n.serviceDescription.Id);var t="Service description "+n.serviceDescription.ServiceName+" loaded into Grasews.";console.log(t);addToastMessage(t,"success")}else addToastMessage(n.message,"warning")},error:function(n,t,i){addToastMessage("ERROR!\n"+n+"\n"+t+"\n"+i,"danger")}})}function uploadServiceDescription(n,t){var i=new Uint8Array(n),r=btoa(new Uint8Array(i).reduce(function(n,t){return n+String.fromCharCode(t)},""));$.ajax({url:"Upload/UploadServiceDescriptionFile",dataType:"json",data:{stringByteArray:r,filename:t},type:"POST",success:function(n){if(n!==null)if(n.serviceDescription!==null){fillCytoscape(JSON.parse(n.serviceDescription.GraphJson));fillCodeMirror(n.serviceDescription.Xml);$("#div-service-description-in-view").show();$("#lbl-service-description-name-in-view").text(n.serviceDescription.ServiceName);$("#treeview-service-description").append(n.serviceDescription.HtmlTreeViewMenu);setCookie(GRASEWS_SERVICEDESCRIPTION_ON_VIEW_COOKIE,n.serviceDescription.Id);createContextMenusForTreeView();hideAllServiceDescriptionsButThis(n.serviceDescription.Id);var t="Service description "+n.serviceDescription.ServiceName+" loaded into Grasews.";console.log(t);addToastMessage(t,"success")}else addToastMessage(n.message,"warning")},error:function(n,t,i){addToastMessage("ERROR!\n"+n+"\n"+t+"\n"+i,"danger")}})}function modalOpenServiceDescription(){$.ajax({url:"Site/_ModalOpenServiceDescription",type:"GET",cache:!1}).done(function(n){$("#place-holder-partial-views").html(n);$("#modal-open-service-description").modal("toggle");load_select2ToHtml();$("#modal-open-service-description").on("shown.bs.modal",function(){$("#modal-open-service-description").find("#fileOpenWsdl").trigger("focus")});$("#nav-tab-open-new-service-description").on("shown.bs.tab",function(){$("#modal-open-service-description").find("#fileOpenWsdl").trigger("focus")});$("#nav-tab-open-saved-service-description").on("shown.bs.tab",function(){$("#modal-open-service-description").find(".select2").trigger("focus")});$("#lnkOpenSavedServiceDescription").on("click",function(){var n=$("#ddl-saved-services-descriptions").val();openSavedServiceDescription(n)});$("#lnkUploadServiceDescription").on("click",function(){var n=document.getElementById("fileOpenWsdl").files[0],i=n.name.replace(/\.[^/.]+$/,""),t=new FileReader;t.onload=function(){uploadServiceDescription(this.result,i);$("#fileOpenWsdl").val("")};t.readAsArrayBuffer(n)})})}function getServiceDescriptionsAlreadyOpened(){$.ajax({url:"Site/GetServiceDescriptionsAlreadyOpened",type:"GET",success:function(n){if(n!==null&&n.length>0){var t=getCookie(GRASEWS_SERVICEDESCRIPTION_ON_VIEW_COOKIE);$.each(n,function(n,i){i.Id.toString()===t&&(fillCytoscape(JSON.parse(i.GraphJson)),adjustUserNodesPositionsOnGraph(JSON.parse(i.GraphJson)),fillCodeMirror(i.Xml),$("#div-service-description-in-view").show(),$("#lbl-service-description-name-in-view").text(i.ServiceName),setCookie(GRASEWS_SERVICEDESCRIPTION_ON_VIEW_COOKIE,t));$("#treeview-service-description").append(i.HtmlTreeViewMenu);hideAllServiceDescriptionsButThis(t);createContextMenusForTreeView();var r="Service description '"+i.ServiceName+"' loaded into Grasews from previous session.";console.log(r);addToastMessage(r,"success")})}},error:function(n,t,i){addToastMessage("ERROR!\n"+n+"\n"+t+"\n"+i,"danger")}})}function closeServiceDescription(n){var r=getCookie(GRASEWS_SERVICEDESCRIPTIONS_OPENED_COOKIE),u,t,i,f;r!==null&&(u=r.split(","),t=[],$.each(u,function(i,r){r!==n&&t.push(r)}),i=t.join(),i!==""?setCookie(GRASEWS_SERVICEDESCRIPTIONS_OPENED_COOKIE,i):eraseCookie(GRASEWS_SERVICEDESCRIPTIONS_OPENED_COOKIE),$("#li-service-description-"+n).remove(),f=getCookie(GRASEWS_SERVICEDESCRIPTION_ON_VIEW_COOKIE),n===f&&(t.length===0?(clearCytoscape(),$("#zoomValue").text(""),$("#div-service-description-in-view").hide(),$("#lbl-service-description-name-in-view").text(""),fillCodeMirror(""),eraseCookie(GRASEWS_SERVICEDESCRIPTION_ON_VIEW_COOKIE)):t.length===1&&(viewServiceDescription(t[0]),setCookie(GRASEWS_SERVICEDESCRIPTION_ON_VIEW_COOKIE,t[0]))))}function viewServiceDescription(n){jQuery.support.cors=!0;setCookie(GRASEWS_SERVICEDESCRIPTION_ON_VIEW_COOKIE,n);$.ajax({url:"Site/ViewOpenedServiceDescription",data:{idServiceDescription:n},type:"GET",success:function(n){if(n!==null)if(n.serviceDescription!==null){fillCytoscape(JSON.parse(n.serviceDescription.GraphJson));adjustUserNodesPositionsOnGraph(JSON.parse(n.serviceDescription.GraphJson));fillCodeMirror(n.serviceDescription.Xml);$("#div-service-description-in-view").show();$("#lbl-service-description-name-in-view").text(n.serviceDescription.ServiceName);hideAllServiceDescriptionsButThis(n.serviceDescription.Id);var t="Service description '"+n.serviceDescription.ServiceName+"' on screen.";console.log(t);addToastMessage(t,"success")}else addToastMessage(n.message,"warning")},error:function(n,t,i){addToastMessage("ERROR!\n"+n+"\n"+t+"\n"+i,"danger")}})}function updateServiceDescription(){var i=cy.json(),r=JSON.stringify(i.elements),n=getCookie(GRASEWS_SERVICEDESCRIPTION_ON_VIEW_COOKIE),t;n!==null&&n!==""&&(t=parseInt(n),$.ajax({url:"Site/UpdateServiceDescription",dataType:"json",data:{idServiceDescription:t,graphJson:r},type:"POST",success:function(n){n.affectedRegisters>0?addToastMessage(n.message,"success"):addToastMessage(n.message,"danger")},error:function(n,t,i){addToastMessage("ERROR!\n"+n+"\n"+t+"\n"+i,"danger")}}))}function refreshServiceDescriptionOnView(){showAjaxLoading=!1;$.ajax({url:"Site/RefreshServiceDescriptionOnView",type:"GET",success:function(n){if(n!==null){fillCytoscape(JSON.parse(n.GraphJson));adjustUserNodesPositionsOnGraph(JSON.parse(n.GraphJson));fillCodeMirror(n.Xml);$("#div-service-description-in-view").show();$("#lbl-service-description-name-in-view").text(n.ServiceName);var i=$("#treeview-service-description").find("#li-service-description-"+n.Id),t;i.length>0?(i[0].innerHTML=$(n.HtmlTreeViewMenu)[0].innerHTML,hideAllServiceDescriptionsButThis(n.Id),createContextMenusForTreeView(),t="Service description '"+n.ServiceName+"' has been refreshed.",addToastMessage(t,"success")):(t="The requested service description has not been found in the tree view menu.",addToastMessage(t,"danger"));console.log(t)}},error:function(n,t,i){addToastMessage("ERROR!\n"+n+"\n"+t+"\n"+i,"danger")},complete:function(){showAjaxLoading=!0}})}function hideOntology(n){$.each($(".ontology-eye"),function(t,i){var r=$(i);r.attr("ontology-id")===n&&(r.addClass("fa-eye"),r.removeClass("fa-eye-slash"),r.addClass("text-green"),r.removeClass("text-red"))})}function openSavedOntology(n){jQuery.support.cors=!0;$.ajax({url:"Site/OpenSavedOntology",data:{idOntology:n},type:"GET",success:function(n){if(n!==null)if(n.ontology!==undefined&&n.ontology!==null){$("#treeview-ontology").append(n.ontology.HtmlTreeViewMenu);createContextMenusForTreeView();var t="Ontology "+n.ontology.OntologyName+" loaded into Grasews.";console.log(t);addToastMessage(t,"success")}else addToastMessage(n.message,"warning")},error:function(n,t,i){addToastMessage("ERROR!\n"+n+"\n"+t+"\n"+i,"danger")}})}function uploadOntology(n){var t=new Uint8Array(n),i=btoa(new Uint8Array(t).reduce(function(n,t){return n+String.fromCharCode(t)},""));$.ajax({url:"Upload/UploadOntologyFile",dataType:"json",data:{stringByteArray:i},type:"POST",success:function(n){if(n!==null)if(n.ontology!==undefined&&n.ontology!==null){$("#treeview-ontology").append(n.ontology.HtmlTreeViewMenu);createContextMenusForTreeView();var t="Ontology "+n.ontology.OntologyName+" loaded into Grasews.";console.log(t);addToastMessage(t,"success");addToastMessage("Ontology saved in the user's repository.","success")}else addToastMessage(n.message,"warning")},error:function(n,t,i){addToastMessage("ERROR!\n"+n+"\n"+t+"\n"+i,"danger")}})}function modalOpenOntology(){$.ajax({url:"Site/_ModalOpenOntology",type:"GET",cache:!1}).done(function(n){$("#place-holder-partial-views").html(n);$("#modal-open-ontology").modal("toggle");load_select2ToHtml();$("#modal-open-ontology").on("shown.bs.modal",function(){$("#modal-open-ontology").find("#fileOpenOwl").trigger("focus")});$("#nav-tab-open-new-ontology").on("shown.bs.tab",function(){$("#modal-open-ontology").find("#fileOpenOwl").trigger("focus")});$("#nav-tab-open-saved-ontology").on("shown.bs.tab",function(){$("#modal-open-ontology").find(".select2").trigger("focus")});$("#lnkOpenSavedOntology").on("click",function(){var n=$("#ddl-saved-ontologies").val();openSavedOntology(n)});$("#lnkUploadOntology").on("click",function(){var t=document.getElementById("fileOpenOwl").files[0],n=new FileReader;n.onload=function(){uploadOntology(this.result);$("#fileOpenOwl").val("")};n.readAsArrayBuffer(t)})})}function getOntologiesAlreadyOpened(){$.ajax({url:"Site/GetOntologiesAlreadyOpened",type:"GET",success:function(n){n!==null&&n.length>0&&$.each(n,function(n,t){$("#treeview-ontology").append(t.HtmlTreeViewMenu);createContextMenusForTreeView();addOntologyToDropDownOnAddModelReferenceModal(t);var i="Ontology '"+t.OntologyName+"' loaded into Grasews from previous session.";console.log(i);addToastMessage(i,"success")})},error:function(n,t,i){addToastMessage("ERROR!\n"+n+"\n"+t+"\n"+i,"danger")}})}function modalAddModelReference(n,t,i,r,u){$.ajax({url:"Site/_ModalAddModelReference",type:"GET",cache:!1}).done(function(f){if(f!==null&&f!==""){$("#place-holder-partial-views").html(f);$("#modal-add-model-reference").modal("toggle");load_select2ToHtml();var e="["+i+"] "+r;$("#lblElementToAddModelReference").text(e);$("#lnkApplyModelReference").unbind("click");$("#lnkApplyModelReference").on("click",function(){addModelReference(n,t,u)});$("#ddl-add-modal-reference-ontologies").on("change",function(){var n=$(this).val(),t=$("#ddl-add-modal-reference-ontology-terms");t.prop("disabled",!0);t.empty();n!=="none"&&loadTermsInDropdownList(n)})}else addToastMessage("No ontologies loaded into Grasews.","warning")})}function loadTermsInDropdownList(n){$.ajax({url:"Site/_ModalAddModelReferenceOntologyTerms",type:"GET",data:{idOntology:n},cache:!1}).done(function(n){var t=$("#ddl-add-modal-reference-ontology-terms");t.append(n);t.prop("disabled",!1);t.on("change",function(){var n=$(this).val();n!=="none"?$("#lnkApplyModelReference").prop("disabled",!1):$("#lnkApplyModelReference").prop("disabled",!0)})})}function addModelReference(n,t,i){var r=$("#ddl-add-modal-reference-ontology-terms option:selected").val();$.ajax({url:"Site/AddSawsdlModelReference",data:{idWsdlElement:n,idWsdlElementType:t,idServiceDescription:i,idOntologyTerm:r},type:"POST",success:function(n){if(n){fillCytoscape(JSON.parse(n.serviceDescription.GraphJson));adjustUserNodesPositionsOnGraph(JSON.parse(n.serviceDescription.GraphJson));fillCodeMirror(n.serviceDescription.Xml);$("#li-service-description-"+i).empty();$("#li-service-description-"+i).html($(n.serviceDescription.HtmlTreeViewMenu)[0].innerHTML);createContextMenusForTreeView();hideAllServiceDescriptionsButThis(n.serviceDescription.Id);var t="SAWSDL Model Reference added successfuly to the service description '"+n.serviceDescription.ServiceName+"'.";console.log(t);addToastMessage(t,"success");window.dispatchEvent(notifyServiceDescriptionUpdateEvent)}else addToastMessage("Error","danger")},error:function(n,t,i){addToastMessage("ERROR!\n"+n+"\n"+t+"\n"+i,"danger")}})}function modalRemoveModelReference(n,t,i,r,u){$.ajax({url:"Site/_ModalRemoveModelReference",type:"GET",data:{idServiceDescription:u,idWsdlElement:n,idWsdlElementType:t},success:function(n){var t,u;if(n!==null&&n!==""){$("#place-holder-partial-views").html(n);t=$("#modal-remove-model-reference");t.modal("toggle");u="["+i+"] "+r;$("#lblElementToRemoveModelReference").text(u);addClickFunctionToEachModelReferenceToBeRemoved();$("#lnkApplyRemoveModelReference").on("click",function(){for(var i="Are you sure you want to remove the annotation(s) below?\n",r=t.find("#model-references-urls-to-remove").val().split(","),n=0;n<r.length;n++)i+="\n"+r[n];if(confirm(i)){var u=t.find("#id-service-description").val(),f=t.find("#id-wsdl-element").val(),e=t.find("#id-wsdl-element-type").val(),o=t.find("#id-ontology-terms-to-remove").val();removeModelReference(u,f,e,o)}})}},error:function(n,t,i){addToastMessage("ERROR!\n"+n+"\n"+t+"\n"+i,"danger")}})}function removeModelReference(n,t,i,r){$.ajax({url:"Site/RemoveSawsdlModelReference",data:{idWsdlElement:t,idWsdlElementType:i,idServiceDescription:n,idOntologyTermsToRemove:r},type:"POST",success:function(t){if(t){fillCytoscape(JSON.parse(t.serviceDescription.GraphJson));adjustUserNodesPositionsOnGraph(JSON.parse(t.serviceDescription.GraphJson));fillCodeMirror(t.serviceDescription.Xml);$("#li-service-description-"+n).empty();$("#li-service-description-"+n).html($(t.serviceDescription.HtmlTreeViewMenu)[0].innerHTML);createContextMenusForTreeView();hideAllServiceDescriptionsButThis(t.serviceDescription.Id);var i="SAWSDL Model Reference(s) removed successfuly from the service description '"+t.serviceDescription.ServiceName+"'.";console.log(i);addToastMessage(i,"success");window.dispatchEvent(notifyServiceDescriptionUpdateEvent)}else addToastMessage("Error","danger")},error:function(n,t,i){addToastMessage("ERROR!\n"+n+"\n"+t+"\n"+i,"danger")}})}function addClickFunctionToEachModelReferenceToBeRemoved(){var n=[],t=[];$("#divListModelReferenceToRemove > a").each(function(){$(this).on("click",function(){n.push($(this).find("span")[0].innerText);t.push($(this).attr("id-ontology-term"));var i=$("#modal-remove-model-reference");i.find("#model-references-urls-to-remove").val(n.join());i.find("#id-ontology-terms-to-remove").val(t.join());this.remove()})})}function modalAddModelReferenceFromOntologyTerm(n){$.ajax({url:"Site/_ModalAddModelReferenceFromOntologyTerm",type:"GET",cache:!1}).done(function(t){$("#place-holder-partial-views").html(t);$("#modal-add-model-reference-from-ontology").modal("toggle");load_select2ToHtml();$("#lnkApplyModelReferenceFromOntology").unbind("click");$("#lnkApplyModelReferenceFromOntology").on("click",function(){addModelReferenceFromOntology(n)})})}function addModelReferenceFromOntology(n){var i=$("#ddl-add-modal-reference-wsdl-element option:selected"),r=i.val(),u=i.attr("id-wsdl-element-type"),t=getCookie(GRASEWS_SERVICEDESCRIPTION_ON_VIEW_COOKIE);$.ajax({url:"Site/AddSawsdlModelReference",data:{idWsdlElement:r,idWsdlElementType:u,idServiceDescription:t,idOntologyTerm:n},type:"POST",success:function(n){if(n){fillCytoscape(JSON.parse(n.serviceDescription.GraphJson));adjustUserNodesPositionsOnGraph(JSON.parse(n.serviceDescription.GraphJson));fillCodeMirror(n.serviceDescription.Xml);$("#li-service-description-"+t).empty();$("#li-service-description-"+t).html($(n.serviceDescription.HtmlTreeViewMenu)[0].innerHTML);createContextMenusForTreeView();hideAllServiceDescriptionsButThis(n.serviceDescription.Id);var i="SAWSDL Model Reference added successfuly to the service description '"+n.serviceDescription.ServiceName+"'.";console.log(i);addToastMessage(i,"success");window.dispatchEvent(notifyServiceDescriptionUpdateEvent)}else addToastMessage("Error","danger")},error:function(n,t,i){addToastMessage("ERROR!\n"+n+"\n"+t+"\n"+i,"danger")}})}function modalAddLiftingSchemaMapping(n,t,i,r,u){$.ajax({url:"Site/_ModalAddLiftingSchemaMapping",type:"GET",cache:!1}).done(function(f){$("#place-holder-partial-views").html(f);$("#modal-lifting-schema-mapping").modal("toggle");var e="["+i+"] "+r;$("#lblElementToAddLiftingSchemaMapping").text(e);$("#lnk-apply-lifting-schema-mapping").on("click",function(){addLiftingSchemaMapping(n,t,u)})})}function modalAddLoweringSchemaMapping(n,t,i,r,u){$.ajax({url:"Site/_ModalAddLoweringSchemaMapping",type:"GET",cache:!1}).done(function(f){$("#place-holder-partial-views").html(f);$("#modal-lowering-schema-mapping").modal("toggle");var e="["+i+"] "+r;$("#lblElementToAddLoweringSchemaMapping").text(e);$("#lnk-apply-lowering-schema-mapping").on("click",function(){addLoweringSchemaMapping(n,t,u)})})}function modalRemoveLoweringSchemaMapping(n,t,i,r,u){$.ajax({url:"Site/_ModalRemoveLoweringSchemaMapping",type:"GET",data:{idServiceDescription:u,idWsdlElement:n,idWsdlElementType:t},success:function(n){var t,u;if(n!==null&&n!==""){$("#place-holder-partial-views").html(n);t=$("#modal-remove-lowering-schema-mapping");t.modal("toggle");u="["+i+"] "+r;$("#lblElementToRemoveLoweringSchemaMapping").text(u);$("#lnkApplyRemoveLoweringSchemaMapping").on("click",function(){if(confirm("Are you sure you want to remove the lowering schema mapping?")){var n=t.find("#id-service-description").val(),i=t.find("#id-wsdl-element").val(),r=t.find("#id-wsdl-element-type").val();removeLoweringSchemaMapping(i,r,n)}})}},error:function(n,t,i){addToastMessage("ERROR!\n"+n+"\n"+t+"\n"+i,"danger")}})}function modalRemoveLiftingSchemaMapping(n,t,i,r,u){$.ajax({url:"Site/_ModalRemoveLiftingSchemaMapping",type:"GET",data:{idServiceDescription:u,idWsdlElement:n,idWsdlElementType:t},success:function(n){var t,u;if(n!==null&&n!==""){$("#place-holder-partial-views").html(n);t=$("#modal-remove-lifting-schema-mapping");t.modal("toggle");u="["+i+"] "+r;$("#lblElementToRemoveLiftingSchemaMapping").text(u);$("#lnkApplyRemoveLiftingSchemaMapping").on("click",function(){if(confirm("Are you sure you want to remove the lifting schema mapping?")){var n=t.find("#id-service-description").val(),i=t.find("#id-wsdl-element").val(),r=t.find("#id-wsdl-element-type").val();removeLiftingSchemaMapping(i,r,n)}})}},error:function(n,t,i){addToastMessage("ERROR!\n"+n+"\n"+t+"\n"+i,"danger")}})}function addLiftingSchemaMapping(n,t,i){var r=$("#txtLiftingSchemaMappingUrl").val();$.ajax({url:"Site/AddSawsdlLiftingSchemaMapping",data:{idWsdlElement:n,idWsdlElementType:t,idServiceDescription:i,liftingSchemaMappingUrl:r},type:"POST",success:function(n){n.ServiceDescription!==undefined&&n.ServiceDescription!==null?(fillCytoscape(JSON.parse(n.ServiceDescription.GraphJson)),adjustUserNodesPositionsOnGraph(JSON.parse(n.ServiceDescription.GraphJson)),fillCodeMirror(n.ServiceDescription.Xml),$("#li-service-description-"+i).empty(),$("#li-service-description-"+i).html($(n.ServiceDescription.HtmlTreeViewMenu)[0].innerHTML),createContextMenusForTreeView(),hideAllServiceDescriptionsButThis(n.ServiceDescription.Id),console.log(n.Message),addToastMessage(n.Message,"success"),window.dispatchEvent(notifyServiceDescriptionUpdateEvent)):addToastMessage(n.Exception.Message,"warning")},error:function(n,t,i){addToastMessage("ERROR!\n"+n+"\n"+t+"\n"+i,"danger")}})}function addLoweringSchemaMapping(n,t,i){var r=$("#txtLoweringSchemaMappingUrl").val();$.ajax({url:"Site/AddSawsdlLoweringSchemaMapping",data:{idWsdlElement:n,idWsdlElementType:t,idServiceDescription:i,loweringSchemaMappingUrl:r},type:"POST",success:function(n){if(n){fillCytoscape(JSON.parse(n.serviceDescription.GraphJson));adjustUserNodesPositionsOnGraph(JSON.parse(n.serviceDescription.GraphJson));fillCodeMirror(n.serviceDescription.Xml);$("#li-service-description-"+i).empty();$("#li-service-description-"+i).html($(n.serviceDescription.HtmlTreeViewMenu)[0].innerHTML);createContextMenusForTreeView();hideAllServiceDescriptionsButThis(n.serviceDescription.Id);var t="SAWSDL Lowering Schema Mapping added successfuly to the service description '"+n.serviceDescription.ServiceName+"'.";console.log(t);addToastMessage(t,"success");window.dispatchEvent(notifyServiceDescriptionUpdateEvent)}else addToastMessage("Error","danger")},error:function(n,t,i){addToastMessage("ERROR!\n"+n+"\n"+t+"\n"+i,"danger")}})}function removeLiftingSchemaMapping(n,t,i){$.ajax({url:"Site/RemoveLiftingSchemaMapping",data:{idWsdlElement:n,idWsdlElementType:t,idServiceDescription:i},type:"POST",success:function(n){if(n){fillCytoscape(JSON.parse(n.serviceDescription.GraphJson));adjustUserNodesPositionsOnGraph(JSON.parse(n.serviceDescription.GraphJson));fillCodeMirror(n.serviceDescription.Xml);$("#li-service-description-"+i).empty();$("#li-service-description-"+i).html($(n.serviceDescription.HtmlTreeViewMenu)[0].innerHTML);createContextMenusForTreeView();hideAllServiceDescriptionsButThis(n.serviceDescription.Id);var t="SAWSDL Lifting Schema Mapping removed successfuly from the service description '"+n.serviceDescription.ServiceName+"'.";console.log(t);addToastMessage(t,"success");window.dispatchEvent(notifyServiceDescriptionUpdateEvent)}else addToastMessage("Error","danger")},error:function(n,t,i){addToastMessage("ERROR!\n"+n+"\n"+t+"\n"+i,"danger")}})}function removeLoweringSchemaMapping(n,t,i){$.ajax({url:"Site/RemoveLoweringSchemaMapping",data:{idWsdlElement:n,idWsdlElementType:t,idServiceDescription:i},type:"POST",success:function(n){if(n){fillCytoscape(JSON.parse(n.serviceDescription.GraphJson));adjustUserNodesPositionsOnGraph(JSON.parse(n.serviceDescription.GraphJson));fillCodeMirror(n.serviceDescription.Xml);$("#li-service-description-"+i).empty();$("#li-service-description-"+i).html($(n.serviceDescription.HtmlTreeViewMenu)[0].innerHTML);createContextMenusForTreeView();hideAllServiceDescriptionsButThis(n.serviceDescription.Id);var t="SAWSDL Lowering Schema Mapping removed successfuly from the service description '"+n.serviceDescription.ServiceName+"'.";console.log(t);addToastMessage(t,"success");window.dispatchEvent(notifyServiceDescriptionUpdateEvent)}else addToastMessage("Error","danger")},error:function(n,t,i){addToastMessage("ERROR!\n"+n+"\n"+t+"\n"+i,"danger")}})}function modalShareServiceDescription(){var n=getCookie(GRASEWS_SERVICEDESCRIPTION_ON_VIEW_COOKIE);n!==null&&n!==""?$.ajax({url:"Site/_ModalShareServiceDescription",type:"GET",success:function(n){$("#place-holder-partial-views").html(n);$("#modal-share").modal("toggle");load_select2ToHtml();$("#modal-share").on("shown.bs.modal",function(){$("#modal-share").find(".select2 input[type=search]").trigger("focus")});$("#lnk-share").click(function(){shareServiceDescription()})},error:function(n,t,i){addToastMessage("ERROR!\n"+n+"\n"+t+"\n"+i,"danger")}}):addToastMessage("There is no service description opened to be shared.","warning")}function shareServiceDescription(){var t=$("#ddl-select-users-to-share").select2("data"),i=t.length,n=[];$.each(t,function(t,r){if(n.push(r.id),!--i){var u=getCookie(GRASEWS_SERVICEDESCRIPTION_ON_VIEW_COOKIE),f=getCookie(GRASEWS_ONTOLOGIES_OPENED_COOKIE),e;e=f?{emails:n,idServiceDescription:u,idOntologies:f}:{emails:n,idServiceDescription:u};$.ajax({url:"Site/ShareServiceDescription",data:e,type:"POST",success:function(n){n!==null&&(n.shareResponse!==undefined&&n.shareResponse!==""?$("#modal-share").modal("toggle"):addToastMessage(n.message,"warning"))},error:function(n,t,i){addToastMessage("ERROR!\n"+n+"\n"+t+"\n"+i,"danger")}})}})}function modalAddTask(){var n=getCookie(GRASEWS_SERVICEDESCRIPTION_ON_VIEW_COOKIE);n!==null&&n!==""?$.ajax({url:"Site/_ModalAddTask",type:"GET",cache:!1}).done(function(n){$("#place-holder-partial-views").html(n);$("#modal-task").modal("toggle");$("#lnk-add-task").on("click",function(){addTask()})}):addToastMessage("There is no service description opened to create a task.","warning")}function modalTaskList(){var n=getCookie(GRASEWS_SERVICEDESCRIPTION_ON_VIEW_COOKIE);n!==null&&n!==""?$.ajax({url:"Site/_ModalTaskList",type:"GET",data:{idServiceDescription:n},cache:!1}).done(function(n){$("#place-holder-partial-views").html(n);$("#modal-task-list").modal("toggle");init_ButtonCheckbox();$(".btn-task-done").on("click",function(){var n=$(this),t=n.attr("id-task"),i=n.closest("div.panel.box"),r=n.hasClass("active"),u=n.attr("task-has-comments");markTaskAsDone(t,i,r,u)});$(".btn-create-task-comment").on("click",function(){var i=$(this),n=i.attr("id-task"),t=$("#txt-new-comment-"+n).val();t!==""&&(addTaskComment(n,t),$("#txt-new-comment-"+n).val(""));$("#txt-new-comment-"+n).focus()})}):addToastMessage("There is no service description opened to view the task list.","warning")}function markTaskAsDone(n,t,i,r){$.ajax({url:"Site/MarkTaskAsDone",data:{idTask:n,done:i},type:"POST",cache:!1}).done(function(){changeTaskStatus(n,t,i,r)})}function changeTaskStatus(n,t,i,r){var u=$("#div-task-status-icon-"+n);i?(t.removeClass("box-primary"),t.removeClass("box-danger"),t.addClass("box-success"),u.find("i.task-done").removeClass("hidden"),u.find("i.task-created").addClass("hidden"),u.find("i.task-with-comments").addClass("hidden"),disableNewComment(!0,n)):(r?(t.addClass("box-primary"),t.removeClass("box-danger"),t.removeClass("box-success"),u.find("i.task-done").addClass("hidden"),u.find("i.task-created").addClass("hidden"),u.find("i.task-with-comments").removeClass("hidden")):(t.removeClass("box-primary"),t.addClass("box-danger"),t.removeClass("box-success"),u.find("i.task-done").addClass("hidden"),u.find("i.task-created").removeClass("hidden"),u.find("i.task-with-comments").addClass("hidden")),disableNewComment(!1,n))}function disableNewComment(n,t){var r=$("#txt-new-comment-"+t),i=$("#btn-create-task-comment-"+t);n?(r.attr("readonly","readonly"),r.attr("disabled","disabled"),i.removeClass("animated-hover"),i.attr("readonly","readonly"),i.attr("disabled","disabled")):(r.removeAttr("readonly"),r.removeAttr("disabled"),i.addClass("animated-hover"),i.removeAttr("readonly"),i.removeAttr("disabled"))}function addTask(){var n=$("#txt-task-title").val(),t=$("#txt-task-description").val(),i=getCookie(GRASEWS_SERVICEDESCRIPTION_ON_VIEW_COOKIE);$.ajax({url:"Site/AddTask",type:"POST",data:{idServiceDescription:i,taskTitle:n,taskDescription:t},cache:!1}).done(function(n){window.dispatchEvent(notifyTaskCreatedEvent);console.log(n.Message);addToastMessage(n.Message,"success")})}function addTaskComment(n,t){$.ajax({url:"Site/AddTaskComment",type:"POST",data:{idTask:n,comment:t},cache:!1}).done(function(t){if(t!==null){var i="<tr><td>"+t.UserEmail+"<\/td><td>"+t.TaskComment+"<\/td><\/tr>",r=$("#div-task-comments-"+n+" table tbody tr:last"),u=$("#div-task-previous-comments-"+n),f=u.hasClass("hidden");f&&u.removeClass("hidden");r.length?r.after(i):$("#div-task-comments-"+n+" table tbody").append(i);$("#div-task-comments-"+n).animate({scrollTop:$("#div-task-comments-"+n).prop("scrollHeight")},1500);var e=$("#panel-box-"+n);changeTaskStatus(n,e,!1,!0);window.dispatchEvent(notifyTaskCommentCreatedEvent);console.log(t.Message);addToastMessage(t.Message,"success")}})}function modalAddIssue(){var n=getCookie(GRASEWS_SERVICEDESCRIPTION_ON_VIEW_COOKIE);n!==null&&n!==""?$.ajax({url:"Site/_ModalAddIssue",type:"GET",cache:!1}).done(function(n){$("#place-holder-partial-views").html(n);$("#modal-issue").modal("toggle");load_select2ToHtml();$("#lnk-add-issue").on("click",function(){addIssue()})}):addToastMessage("There is no service description opened to create an issue.","warning")}function modalIssueList(){var n=getCookie(GRASEWS_SERVICEDESCRIPTION_ON_VIEW_COOKIE);n!==null&&n!==""?$.ajax({url:"Site/_ModalIssueList",type:"GET",data:{idServiceDescription:n},cache:!1}).done(function(n){$("#place-holder-partial-views").html(n);$("#modal-issue-list").modal("toggle");init_ButtonCheckbox();$(".btn-issue-done").on("click",function(){var n=$(this),t=n.attr("id-issue"),i=n.closest("div.panel.box"),r=n.hasClass("active"),u=n.attr("issue-has-answers");markIssueAsSolved(t,i,r,u)});$(".btn-create-issue-answer").on("click",function(){var i=$(this),n=i.attr("id-issue"),t=$("#txt-new-answer-"+n).val();t!==""&&(addIssueAnswer(n,t),$("#txt-new-answer-"+n).val(""));$("#txt-new-answer-"+n).focus()})}):addToastMessage("There is no service description opened to view the issue list.","warning")}function markIssueAsSolved(n,t,i,r){var u=$("#hidden-issue-"+n+"-id-service-description-element").val(),f=$("#hidden-issue-"+n+"-id-service-description-element-type").val();changeIssueStatus(n,t,i,r);showAjaxLoading=!1;$.ajax({url:"Site/MarkIssueAsSolved",data:{idIssue:n,solved:i,idWsdlElement:u,idWsdlElementType:f},type:"POST",cache:!1,success:function(n){fillCytoscape(JSON.parse(n.Issue.ServiceDescription.GraphJson));adjustUserNodesPositionsOnGraph(JSON.parse(n.Issue.ServiceDescription.GraphJson));window.dispatchEvent(notifyServiceDescriptionUpdateEvent)},complete:function(){showAjaxLoading=!0}})}function changeIssueStatus(n,t,i,r){var u=$("#div-issue-status-icon-"+n);i?(t.removeClass("box-primary"),t.removeClass("box-danger"),t.addClass("box-success"),u.find("i.issue-solved").removeClass("hidden"),u.find("i.issue-created").addClass("hidden"),u.find("i.issue-with-answers").addClass("hidden"),disableNewAnswer(!0,n)):(r?(t.addClass("box-primary"),t.removeClass("box-danger"),t.removeClass("box-success"),u.find("i.issue-solved").addClass("hidden"),u.find("i.issue-created").addClass("hidden"),u.find("i.issue-with-answers").removeClass("hidden")):(t.removeClass("box-primary"),t.addClass("box-danger"),t.removeClass("box-success"),u.find("i.issue-solved").addClass("hidden"),u.find("i.issue-created").removeClass("hidden"),u.find("i.issue-with-answers").addClass("hidden")),disableNewAnswer(!1,n))}function disableNewAnswer(n,t){var r=$("#txt-new-answer-"+t),i=$("#btn-create-issue-answer-"+t);n?(r.attr("readonly","readonly"),r.attr("disabled","disabled"),i.removeClass("animated-hover"),i.attr("readonly","readonly"),i.attr("disabled","disabled")):(r.removeAttr("readonly"),r.removeAttr("disabled"),i.addClass("animated-hover"),i.removeAttr("readonly"),i.removeAttr("disabled"))}function addIssue(){var t=$("#txt-issue-title").val(),i=$("#txt-issue-description").val(),n=$("#ddl-add-issue-wsdl-element option:selected"),r=n.val(),u=n.attr("id-wsdl-element-type"),f=getCookie(GRASEWS_SERVICEDESCRIPTION_ON_VIEW_COOKIE);$.ajax({url:"Site/AddIssue",type:"POST",data:{idServiceDescription:f,issueTitle:t,issueDescription:i,idWsdlElement:r,idWsdlElementType:u},cache:!1,success:function(n){fillCytoscape(JSON.parse(n.Issue.ServiceDescription.GraphJson));adjustUserNodesPositionsOnGraph(JSON.parse(n.Issue.ServiceDescription.GraphJson));window.dispatchEvent(notifyIssueCreatedEvent);console.log(n.Message);addToastMessage(n.Message,"success");window.dispatchEvent(notifyServiceDescriptionUpdateEvent)}})}function addIssueAnswer(n,t){$.ajax({url:"Site/AddIssueAnswer",type:"POST",data:{idIssue:n,answer:t},cache:!1}).done(function(t){if(t!==null){var i="<tr><td>"+t.UserEmail+"<\/td><td>"+t.IssueAnswer+"<\/td><\/tr>",r=$("#div-task-comments-"+n+" table tbody tr:last"),u=$("#div-issue-previous-answers-"+n),f=u.hasClass("hidden");f&&u.removeClass("hidden");r.length?r.after(i):$("#div-issue-answers-"+n+" table tbody").append(i);$("#div-issue-answers-"+n).animate({scrollTop:$("#div-issue-answers-"+n).prop("scrollHeight")},1500);var e=$("#panel-box-"+n);changeIssueStatus(n,e,!1,!0);window.dispatchEvent(notifyIssueAnswerCreatedEvent);console.log(t.Message);addToastMessage(t.Message,"success")}})}function reOpenWebServiceAfterOperation(n){fillCytoscape(n.cytoscape);fillWebServiceTreeView(n.wsdlDocument);fillCodeMirror(n.wsdlDocument.WsdlRaw);saveWebServiceInSession(n.wsdlDocument);$("#div-service-description-in-view").show();$("#lbl-service-description-name-in-view").text(n.wsdlDocument.ServiceName);updateServiceDescription()}function addOntologyToDropDownOnAddModelReferenceModal(n){var t=$("#ddl-add-modal-reference-ontology"),i='<option id="opt-'+n.Id+'" value="'+n.Id+'">'+n.OntologyName+"<\/option>";t.append(i)}function removeOntologyFromDropDownOnAddModelReferenceModal(n){var t=$("#ddl-add-modal-reference-ontology"),i=t.find("#opt-"+n);i.remove()}function createListOfTerms(n,t){var i="",u=n.Id,r;return $.each(n.Terms,function(n,f){r=f.TermName;f.TermName.length>21&&(r=f.TermName.substring(0,20)+"...");i=i+'<li class="treeview ontologyElementContextMenu" ontology-id="'+u+'" term-id="'+f.Id+'">';i=i+' <a href="#">';i=i+'     <i class="fa fa-circle-o" style="color: '+t+'"><\/i>';i=i+'     <span data-toggle="tooltip" data-placement="top" title="'+f.TermName+'">';i=i+r;i=i+"     <\/span>";var e=f.Terms!==null&&f.Terms.length>0&&f.Terms[0]!==null;e&&(i=i+' <span class="pull-right-container">',i=i+'     <i class="fa fa-angle-right pull-left"><\/i>',i=i+" <\/span>");i=i+" <\/a>";e&&(i=i+'<ul class="treeview-menu">',i=i+createListOfTerms(f,t),i=i+"<\/ul>");i=i+"<\/li>"}),i}var GRASEWS_SERVICEDESCRIPTIONS_OPENED_COOKIE="GRASEWS_SERVICEDESCRIPTIONS_OPENED_COOKIE",GRASEWS_ONTOLOGIES_OPENED_COOKIE="GRASEWS_ONTOLOGIES_OPENED_COOKIE",GRASEWS_SERVICEDESCRIPTION_ON_VIEW_COOKIE="GRASEWS_SERVICEDESCRIPTION_ON_VIEW_COOKIE",listOfModelReferencesRemoved=[],showAjaxLoading=!0,notifyServiceDescriptionUpdateEvent=new Event("notifyServiceDescriptionUpdateEvent"),notifyTaskCreatedEvent=new Event("notifyTaskCreatedEvent"),notifyIssueCreatedEvent=new Event("notifyIssueCreatedEvent"),notifyTaskCommentCreatedEvent=new Event("notifyTaskCommentCreatedEvent"),notifyIssueAnswerCreatedEvent=new Event("notifyIssueAnswerCreatedEvent");$(document).ajaxStart(function(){startAjaxLoading()});$(document).ajaxStop(function(){stopAjaxLoading()});$(function(){$("#modal-launcher, #modal-background, #modal-close").click(function(){$("#modal-content,#modal-background").toggleClass("active")});$('[data-toggle="tooltip"]').tooltip({container:"body"});load_select2ToHtml();init_ButtonCheckbox();$("#select-ontology").change(function(){});$("#lnk-save").click(function(){updateServiceDescription()});$("#lnk-export-image").click(function(){exportImage()});$("#lnk-open-share").click(function(){modalShareServiceDescription()});$("#lnk-refresh-service-description").click(function(){refreshServiceDescriptionOnView();blockEditing(!1)});$("#lnk-open-service-description").click(function(){modalOpenServiceDescription()});$("#lnk-open-ontology").click(function(){modalOpenOntology()});$("#lnk-open-download").click(function(){});$("#lnk-open-create-issue").click(function(){modalAddIssue()});$("#lnk-open-issues-list").click(function(){modalIssueList()});$("#lnk-open-create-task").click(function(){modalAddTask()});$("#lnk-open-tasks-list").click(function(){modalTaskList()});getServiceDescriptionsAlreadyOpened();getOntologiesAlreadyOpened();initCodeMirrorEditor();$.connection.serviceDescriptionHub.client.broadcastNotificationServiceDescriptionUpdate=function(n){var t=getCookie(GRASEWS_SERVICEDESCRIPTION_ON_VIEW_COOKIE);parseInt(t)===n&&refreshServiceDescriptionOnView()};$.connection.serviceDescriptionHub.client.broadcastNotificationTaskCreated=function(n,t){var i=getCookie(GRASEWS_SERVICEDESCRIPTION_ON_VIEW_COOKIE);parseInt(i)===n&&addToastMessage(t,"success")};$.connection.serviceDescriptionHub.client.broadcastNotificationTaskCommentCreated=function(n,t){var i=getCookie(GRASEWS_SERVICEDESCRIPTION_ON_VIEW_COOKIE);parseInt(i)===n&&addToastMessage(t,"success")};$.connection.serviceDescriptionHub.client.broadcastNotificationIssueCreated=function(n,t){var i=getCookie(GRASEWS_SERVICEDESCRIPTION_ON_VIEW_COOKIE);parseInt(i)===n&&addToastMessage(t,"success")};$.connection.serviceDescriptionHub.client.broadcastNotificationIssueAnswerCreated=function(n,t){var i=getCookie(GRASEWS_SERVICEDESCRIPTION_ON_VIEW_COOKIE);parseInt(i)===n&&addToastMessage(t,"success")};$.connection.hub.start().done(function(){window.addEventListener("notifyServiceDescriptionUpdateEvent",function(){var n=getCookie(GRASEWS_SERVICEDESCRIPTION_ON_VIEW_COOKIE);$.connection.serviceDescriptionHub.server.notifyServiceDescriptionUpdate(n)},!1);window.addEventListener("notifyTaskCreatedEvent",function(){var n=getCookie(GRASEWS_SERVICEDESCRIPTION_ON_VIEW_COOKIE);$.connection.serviceDescriptionHub.server.notifyTaskCreated(n)},!1);window.addEventListener("notifyTaskCommentCreatedEvent",function(){var n=getCookie(GRASEWS_SERVICEDESCRIPTION_ON_VIEW_COOKIE);$.connection.serviceDescriptionHub.server.notifyTaskCommentCreated(n)},!1);window.addEventListener("notifyIssueCreatedEvent",function(){var n=getCookie(GRASEWS_SERVICEDESCRIPTION_ON_VIEW_COOKIE);$.connection.serviceDescriptionHub.server.notifyIssueCreated(n)},!1);window.addEventListener("notifyIssueAnswerCreatedEvent",function(){var n=getCookie(GRASEWS_SERVICEDESCRIPTION_ON_VIEW_COOKIE);$.connection.serviceDescriptionHub.server.notifyIssueAnswerCreated(n)},!1)});$(window).bind("keydown",function(n){if(n.ctrlKey||n.metaKey)switch(String.fromCharCode(n.which).toLowerCase()){case"s":n.preventDefault();updateServiceDescription();break;case"i":n.preventDefault();modalAddIssue();break;case"¿":n.preventDefault();modalIssueList();break;case"m":n.preventDefault();modalAddTask();break;case"þ":n.preventDefault();modalTaskList()}})});