(function(n){typeof exports=="object"&&typeof module=="object"?n(require("../../lib/codemirror")):typeof define=="function"&&define.amd?define(["../../lib/codemirror"],n):n(CodeMirror)})(function(n){"use strict";function e(n){n.state.markedSelection&&n.operation(function(){h(n)})}function o(n){n.state.markedSelection&&n.state.markedSelection.length&&n.operation(function(){u(n)})}function i(n,i,u,f){var o,c,e;if(t(i,u)!=0)for(o=n.state.markedSelection,c=n.state.markedSelectionStyle,e=i.line;;){var v=e==i.line?i:s(e,0),h=e+r,l=h>=u.line,y=l?u:s(h,0),a=n.markText(v,y,{className:c});if(f==null?o.push(a):o.splice(f++,0,a),l)break;e=h}}function u(n){for(var t=n.state.markedSelection,i=0;i<t.length;++i)t[i].clear();t.length=0}function f(n){var r,t;for(u(n),r=n.listSelections(),t=0;t<r.length;t++)i(n,r[t].from(),r[t].to())}function h(n){var o,s;if(!n.somethingSelected())return u(n);if(n.listSelections().length>1)return f(n);var h=n.getCursor("start"),c=n.getCursor("end"),e=n.state.markedSelection;if(!e.length)return i(n,h,c);if(o=e[0].find(),s=e[e.length-1].find(),!o||!s||c.line-h.line<=r||t(h,s.to)>=0||t(c,o.from)<=0)return f(n);while(t(h,o.from)>0)e.shift().clear(),o=e[0].find();for(t(h,o.from)<0&&(o.to.line-h.line<r?(e.shift().clear(),i(n,h,o.to,0)):i(n,h,o.from,0));t(c,s.to)<0;)e.pop().clear(),s=e[e.length-1].find();t(c,s.to)>0&&(c.line-s.from.line<r?(e.pop().clear(),i(n,s.from,c)):i(n,s.to,c))}n.defineOption("styleSelectedText",!1,function(t,i,r){var s=r&&r!=n.Init;if(i&&!s){t.state.markedSelection=[];t.state.markedSelectionStyle=typeof i=="string"?i:"CodeMirror-selectedtext";f(t);t.on("cursorActivity",e);t.on("change",o)}else!i&&s&&(t.off("cursorActivity",e),t.off("change",o),u(t),t.state.markedSelection=t.state.markedSelectionStyle=null)});var r=8,s=n.Pos,t=n.cmpPos});